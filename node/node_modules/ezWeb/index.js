var url=require('url');
var path=require('path');
var express = require('express');
var app = express();
var appRoot = __dirname.replace('/node/node_modules/ezWeb','').replace('\\node\\node_modules\\ezWeb','');
function fileResp(req, resp){
	var urlData = url.parse(req.url,true);
	var action = urlData.pathname;
	var extName = action.split('.').pop();
	var filename = path.join(appRoot, action);
	resp.sendfile(filename);
}

module.exports = {
	config: function(){		
		app.use(express.bodyParser());
		app.use(express.cookieParser());
		app.use(express.session({secret: 'TW'}));
		app.get('/', fileResp);
		app.get('/app/*', fileResp);		
		app.get('/fonts/*', fileResp);
		app.get('/css/*', fileResp);
		app.get('/js/*', fileResp);
		app.get('/layouts/*', fileResp);
		app.get('/lib/*', fileResp);		
		return app;
	},
	fileResp: fileResp,
	start: function(port){
		app.listen(port);
		console.log('The root of ezWeb server is '+appRoot);
		console.log('ezWeb server is running on '+port+' port');
		return app;
	}
};
